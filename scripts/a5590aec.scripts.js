angular.module("timer",[]).directive("timer",["$compile",function(a){return{restrict:"E",replace:!1,scope:{interval:"=interval",startTimeAttr:"=startTime",countdownattr:"=countdown"},controller:["$scope","$element","$attrs",function(b,c,d){function e(){b.timeoutId&&clearTimeout(b.timeoutId)}function f(){b.seconds=Math.floor(b.millis/1e3%60),b.minutes=Math.floor(b.millis/6e4%60),b.hours=Math.floor(b.millis/36e5%24),b.days=Math.floor(b.millis/36e5/24)}b.autoStart=d.autoStart||d.autostart,0===c.html().trim().length&&c.append(a("<span>{{millis}}</span>")(b)),b.startTime=null,b.timeoutId=null,b.countdown=b.countdownattr&&parseInt(b.countdownattr,10)>0?parseInt(b.countdownattr,10):void 0,b.isRunning=!1,b.$on("timer-start",function(){b.start()}),b.$on("timer-resume",function(){b.resume()}),b.$on("timer-stop",function(){b.stop()}),b.$on("timer-end",function(){b.end()}),b.start=c[0].start=function(){b.startTime=b.startTimeAttr?new Date(b.startTimeAttr):new Date,b.countdown=b.countdownattr&&parseInt(b.countdownattr,10)>0?parseInt(b.countdownattr,10):void 0,e(),b.$emit("timer-started"),g()},b.resume=c[0].resume=function(){e(),b.countdownattr&&(b.countdown+=1),b.startTime=new Date-(b.stoppedTime-b.startTime),b.$emit("timer-resumed"),g()},b.stop=b.pause=c[0].stop=c[0].pause=function(){b.stoppedTime=new Date,e(),b.$emit("timer-stopped",{millis:b.millis,seconds:b.seconds,minutes:b.minutes,hours:b.hours,days:b.days}),b.timeoutId=null},b.end=c[0].end=function(){e(),b.startTime=null,b.timeoutId=null,b.countdown=b.countdownattr&&parseInt(b.countdownattr,10)>0?parseInt(b.countdownattr,10):void 0,b.isRunning=!1,b.$emit("timer-ended",{millis:b.millis,seconds:b.seconds,minutes:b.minutes,hours:b.hours,days:b.days}),b.countdownattr&&(b.millis=0,f(),f())},c.bind("$destroy",function(){e()}),b.millis=b.countdownattr?1e3*b.countdownattr:0,f();var g=function(){b.millis=new Date-b.startTime;var a=b.millis%1e3;if(b.countdownattr&&(b.millis=1e3*b.countdown),f(),b.countdown>0)b.countdown--;else if(b.countdown<=0)return b.end(),void 0;b.timeoutId=setTimeout(function(){g(),b.$apply()},b.interval-a),b.$emit("timer-tick",{timeoutId:b.timeoutId,millis:b.millis})};(void 0==b.autoStart||1==b.autoStart)&&b.start()}]}}]),function(){"use strict";angular.module("worldmapApp",["firebase","ngRoute","timer","ui.bootstrap","ui.keypress"]).config(["$routeProvider",function(a){return a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}])}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("worldmapApp").controller("MainCtrl",["$scope","angularFire","$q","$http",function(b,c,d,e){var f,g;return f="https://worldmap.firebaseio.com/countryhits",g=[e.get("/data/countries.json"),c(f,b,"countryHits",{})],d.all(g).then(function(c){var d;return d=c[0].data,b.timer=function(a){return b.$broadcast("timer-"+a)},b.opts={backdropFade:!0,dialogFade:!0},b.input={},b.continents=["Europe","Asia","Africa","North America","South America","Oceania"],b.$on("timer-started",function(){return b.boardState="playing"}),b.$on("timer-resumed",function(){return b.boardState="playing"}),b.$on("timer-stopped",function(){return b.boardState="paused"}),b.$on("timer-ended",function(){return b.boardState="lose"}),b.findCountry=function(){var c,e;return e=b.input.country.toLowerCase().replace(/^st\. /,"st ").replace(/^st /,"saint "),c=_.find(d,function(b){return a.call(_.map([b.name].concat(b.altNames),function(a){return null!=a?a.toLowerCase():void 0}),e)>=0}),c&&!c.found?(c.found=!0,0===_.filter(d,{found:!1}).length&&(b.timer("stop"),b.boardState="win"),b.input.country="",b.countryHits[c.id]=b.countryHits[c.id]?b.countryHits[c.id]+1:1):void 0},(b.initBoard=function(){var a;return b.countries=function(){var b,c,e;for(e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(_.extend(a,{found:!1}));return e}(),b.boardState="pre"})()})}])}.call(this);